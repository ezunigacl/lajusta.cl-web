<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renta Privada | La Justa</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;600;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ocean: '#022C43',
                        oceanLight: '#053B58',
                        oceanDark: '#011826',
                        acid: '#CCFF00',
                        acidHover: '#b3e600',
                        lightText: '#E6F4F1',
                        paper: '#F3F4F6'
                    },
                    fontFamily: {
                        serif: ['Instrument Serif', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'], 
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #022C43; color: #E6F4F1; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        .glass-panel { 
            background: rgba(5, 59, 88, 0.4); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
        }
        
        .btn-3d { transition: all 0.1s ease; box-shadow: 4px 4px 0px rgba(0,0,0,0.5); }
        .btn-3d:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px rgba(0,0,0,0.5); }
        
        .cta-button {
            background-color: #CCFF00; color: #022C43;
            font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em;
            border-radius: 0.25rem; transition: all 0.2s ease;
            box-shadow: 0 4px 0px 0px #8eb300; font-family: 'Inter', sans-serif;
        }
        .cta-button:active { transform: translateY(2px); box-shadow: 0 0px 0px 0px #8eb300; }
        
        .input-premium {
            background-color: rgba(5, 59, 88, 0.2) !important; 
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: #F3F4F6 !important; 
            width: 100%; padding: 0.5rem; border-radius: 0.375rem;
        }
        .input-premium:focus { border-color: #CCFF00 !important; outline: none; }
        
        .grid-bg {
            background-image: linear-gradient(rgba(204, 255, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(204, 255, 0, 0.05) 1px, transparent 1px);
            background-size: 40px 40px; position: fixed; inset: 0; z-index: -1; pointer-events: none;
        }
        
        /* Ajuste Widget UF */
        #ufWidgetContainer input { color: #CCFF00 !important; font-family: 'Space Mono', monospace; border-color: rgba(204, 255, 0, 0.3) !important; }
    </style>
</head>
<body class="antialiased selection:bg-acid selection:text-ocean flex flex-col min-h-screen">
    
    <div class="grid-bg"></div>

    <nav class="fixed w-full z-50 glass-panel border-b-0 border-white/5 rounded-none border-t-0 border-x-0 top-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0 cursor-pointer flex items-center gap-4">
                    <a href="index.html" class="flex items-center gap-3 group">
                        <img src="Logo.jpg" alt="Logo" class="h-10 w-10 rounded-lg border border-white/10 group-hover:border-acid transition-colors object-cover">
                        <span class="font-serif text-2xl md:text-3xl text-acid tracking-wide">La Justa<span class="text-white">.</span></span>
                    </a>
                    
                    <div class="hidden lg:flex items-center space-x-2 bg-oceanLight/50 border border-white/10 px-3 py-1 rounded-md ml-4" id="ufWidgetContainer">
                        <span class="text-[10px] font-sans font-bold uppercase flex items-center gap-1 text-white/80">
                            UF Hoy <button onclick="fetchUF()" title="Actualizar" class="hover:text-acid cursor-pointer"><i class="ph ph-arrows-clockwise"></i></button>
                        </span>
                        <div class="flex items-center">
                            <span class="text-white/60 font-mono mr-1 text-xs">$</span>
                            <input type="text" id="inputUFValue" placeholder="..." class="w-20 bg-transparent text-acid font-bold text-sm border-b border-acid/50 focus:border-acid focus:outline-none text-right placeholder-white/30 font-mono">
                        </div>
                    </div>
                </div>
                
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8 font-mono text-sm">
                        <a href="index.html" class="text-white hover:text-acid transition-colors">INICIO</a>
                        <a href="simulador.html" class="text-white hover:text-acid transition-colors">SIMULADOR</a>
                        <a href="auditorscomp.html" class="text-white hover:text-acid transition-colors">AUDITOR</a>
                        <a href="#" class="text-acid glow-sm border-b border-acid pb-1">[ RENTA PRIVADA ]</a>
                        <a href="index.html#login" class="border border-acid text-acid px-4 py-2 hover:bg-acid hover:text-ocean transition-all btn-3d">ACCESO</a>
                    </div>
                </div>
                
                <div class="md:hidden">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-white hover:text-acid p-2"><i data-lucide="menu" class="w-8 h-8"></i></button>
                </div>
            </div>
        </div>
        
        <div id="mobile-menu" class="hidden md:hidden bg-oceanDark/95 backdrop-blur-xl border-t border-white/10 absolute w-full left-0">
            <div class="px-4 pt-2 pb-6 space-y-2 font-mono text-sm">
                <a href="index.html" class="block px-3 py-4 text-white">INICIO</a>
                <a href="simulador.html" class="block px-3 py-4 text-white">SIMULADOR PENSION</a>
                <a href="rentaprivada.html" class="block px-3 py-4 text-acid font-bold">RENTA PRIVADA</a>
                <a href="eld.html" class="block px-3 py-4 text-white">OPTIMIZADOR ELD</a>
            </div>
        </div>
    </nav>

    <div class="pt-24 lg:pt-32"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 mb-20 flex-grow">
        
        <div class="text-center mb-10">
            <span class="font-mono text-acid text-xs tracking-[0.3em] uppercase mb-2 block">Herramienta 03</span>
            <h1 class="font-serif text-4xl md:text-5xl text-white mb-4">Simulador de Renta Privada</h1>
            <p class="text-gray-400 max-w-lg mx-auto text-sm font-sans">
                Proyección financiera avanzada para rentas vitalicias privadas fuera del sistema de AFP. Retorno de inversión y cobertura de longevidad.
            </p>
        </div>

        <div class="flex flex-col lg:flex-row gap-8 items-start">
            
            <div class="w-full lg:w-1/3 flex flex-col gap-6">
                <div class="glass-panel p-8 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-acid opacity-50"></div>
                    
                    <h2 class="font-mono text-xs text-acid mb-6 uppercase tracking-widest flex items-center gap-2">
                        <i class="ph ph-sliders-horizontal text-lg"></i> Parámetros
                    </h2>
                    
                    <div class="space-y-5 text-sm">
                        <div>
                            <label class="font-bold text-xs text-gray-400 uppercase block mb-2">Capital a Invertir (UF)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-acid font-mono font-bold">UF</span>
                                <input type="number" id="inputCapital" class="input-premium pl-10 font-bold text-white text-lg" placeholder="Ej: 5000">
                            </div>
                            <p class="text-[10px] text-gray-500 mt-1 text-right" id="capitalCLP">$0 CLP</p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="font-bold text-xs text-gray-400 uppercase block mb-2">Nacimiento</label>
                                <input type="date" id="inputDob" class="input-premium text-gray-300 text-xs">
                            </div>
                            <div>
                                <label class="font-bold text-xs text-gray-400 uppercase block mb-2">Género</label>
                                <select id="inputGender" class="input-premium cursor-pointer text-xs">
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                </select>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-white/10">
                            <label class="flex justify-between text-xs font-bold text-gray-400 uppercase mb-2">
                                <span>Tasa Interés (Venta)</span>
                                <span class="text-acid" id="rateDisplay">2.8%</span>
                            </label>
                            <input type="range" id="inputRate" min="2.0" max="3.5" step="0.1" value="2.8" class="w-full accent-acid cursor-pointer h-2 bg-oceanDark rounded-lg appearance-none">
                            <div class="flex justify-between text-[9px] text-gray-500 mt-1 font-mono">
                                <span>2.0%</span>
                                <span>3.5%</span>
                            </div>
                        </div>

                        <div>
                            <label class="font-bold text-xs text-gray-400 uppercase block mb-2">Periodo Garantizado</label>
                            <select id="inputGuarantee" class="input-premium cursor-pointer text-xs">
                                <option value="0">Sin Garantía (Simple)</option>
                                <option value="5">5 Años</option>
                                <option value="10">10 Años</option>
                                <option value="15">15 Años</option>
                                <option value="20">20 Años</option>
                            </select>
                        </div>

                        <div class="flex items-center gap-3 p-3 border border-white/5 rounded bg-oceanLight/20">
                            <input type="checkbox" id="checkSpouse" class="w-4 h-4 rounded text-acid focus:ring-acid bg-oceanDark border-white/20">
                            <label for="checkSpouse" class="text-xs text-gray-300">Incluir Cónyuge (Sobrevivencia 60%)</label>
                        </div>

                        <button onclick="calculateRenta()" class="cta-button w-full py-4 text-sm mt-2">
                            CALCULAR PENSIÓN
                        </button>
                    </div>
                </div>
            </div>

            <div class="w-full lg:w-2/3 flex flex-col gap-6">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-panel p-6 border-l-4 border-acid relative overflow-hidden">
                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Pensión Mensual Estimada</span>
                        <div class="flex items-baseline gap-2 mt-2">
                            <span class="text-4xl font-serif text-white font-bold" id="resPensionUF">0,00</span>
                            <span class="text-xl text-acid font-bold">UF</span>
                        </div>
                        <p class="text-sm text-gray-400 mt-1 font-mono" id="resPensionCLP">$0 líquidos aprox.</p>
                        <i class="ph ph-coins absolute top-4 right-4 text-4xl text-white/5"></i>
                    </div>

                    <div class="flex flex-col gap-4">
                        <div class="glass-panel p-4 flex items-center justify-between border-l-4 border-blue-500">
                            <div>
                                <span class="text-[9px] font-bold text-gray-400 uppercase">Retorno de Inversión (Payback)</span>
                                <div class="text-xl font-mono text-white mt-1"><span id="resPayback">0</span> <span class="text-sm text-gray-500">años</span></div>
                                <p class="text-[9px] text-gray-500">(<span id="resPaybackMonths">0</span> meses aprox.)</p>
                            </div>
                            <i class="ph ph-hourglass text-2xl text-blue-500/50"></i>
                        </div>
                        <div class="glass-panel p-4 flex items-center justify-between border-l-4 border-red-400">
                            <div>
                                <span class="text-[9px] font-bold text-gray-400 uppercase">Impuesto Estimado (Mensual)</span>
                                <div class="text-xl font-mono text-white mt-1" id="resTax">$0</div>
                                <p class="text-[9px] text-gray-500">Solo tributa el interés implícito</p>
                            </div>
                            <i class="ph ph-receipt text-2xl text-red-400/50"></i>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6">
                    <div class="flex items-center gap-2 mb-6">
                        <i class="ph ph-chart-line-up text-acid text-xl"></i>
                        <h3 class="font-serif text-xl text-white">Proyección de Flujos Acumulados</h3>
                    </div>
                    <div class="h-64 w-full">
                        <canvas id="breakevenChart"></canvas>
                    </div>
                </div>

                <div class="bg-oceanLight/30 border border-white/10 p-4 rounded-lg flex gap-4 items-start">
                    <i class="ph ph-scales text-gray-400 text-xl shrink-0 mt-1"></i>
                    <div class="text-xs text-gray-400 font-sans leading-relaxed">
                        <strong class="text-white block mb-1">Normativa Ley N.º 21.420</strong>
                        Las rentas privadas con periodo garantizado contratadas a partir de febrero 2022 están afectas al Impuesto a la Herencia sobre el valor presente de las cuotas garantizadas remanentes en caso de fallecimiento.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <footer class="bg-oceanDark pt-16 pb-8 border-t border-white/10 text-sm mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center text-xs text-gray-600 font-mono">
                <p>&copy; 2025 La Justa Fintech SpA. Todos los derechos reservados.</p>
                <a href="index.html" class="mt-4 md:mt-0 text-xs border border-white/20 text-gray-400 hover:text-white hover:border-white px-4 py-2 rounded transition-colors flex items-center gap-2 btn-3d bg-oceanLight/30">
                    <i class="ph ph-house"></i> Volver al Inicio
                </a>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        // --- LÓGICA DE NEGOCIO ---
        let currentUF = 38000; // Valor por defecto
        let chartInstance = null;

        // Fetch UF
        async function fetchUF() {
            const inputUF = document.getElementById('inputUFValue');
            inputUF.placeholder = "...";
            try {
                const res = await fetch('https://mindicador.cl/api/uf');
                const data = await res.json();
                currentUF = data.serie[0].valor;
                inputUF.value = new Intl.NumberFormat('es-CL', {minimumFractionDigits: 2}).format(currentUF);
                updateConversions();
            } catch (e) { console.warn("Error UF API"); }
        }

        // Helpers
        const formatMoney = (n) => new Intl.NumberFormat('es-CL', {style:'currency', currency:'CLP', maximumFractionDigits:0}).format(n);
        const formatUF = (n) => new Intl.NumberFormat('es-CL', {minimumFractionDigits:2, maximumFractionDigits:2}).format(n);

        // Events
        document.getElementById('inputRate').addEventListener('input', (e) => document.getElementById('rateDisplay').innerText = e.target.value + "%");
        document.getElementById('inputCapital').addEventListener('input', updateConversions);

        function updateConversions() {
            const cap = parseFloat(document.getElementById('inputCapital').value) || 0;
            document.getElementById('capitalCLP').innerText = formatMoney(cap * currentUF);
        }

        // Math Engine (Simplified for Frontend)
        function calculateRenta() {
            const capital = parseFloat(document.getElementById('inputCapital').value) || 0;
            const rate = parseFloat(document.getElementById('inputRate').value) / 100;
            const guarantee = parseInt(document.getElementById('inputGuarantee').value);
            const gender = document.getElementById('inputGender').value;
            const dob = document.getElementById('inputDob').value;
            const hasSpouse = document.getElementById('checkSpouse').checked;

            if(capital <= 0) return;

            // Age Calc
            let age = 60;
            if(dob) {
                const diff = Date.now() - new Date(dob).getTime();
                age = Math.abs(new Date(diff).getUTCFullYear() - 1970);
            }

            // Factor Actuarial Base (Aproximación Woolhouse simplificada)
            // Life Expectancy Proxy: M=85, F=90. Adjusted by rate.
            let lifeExp = gender === 'M' ? 85 : 90;
            if(hasSpouse) lifeExp += 3; // Sobrecosto conjunto
            
            let n = lifeExp - age; 
            if(n < 5) n = 5;

            // Anualidad Vitalicia apx
            let annuity = (1 - Math.pow(1 + rate, -n)) / rate;
            
            // Ajuste Garantía (Anualidad Cierta + Diferida)
            if(guarantee > 0) {
                const annuityCertain = (1 - Math.pow(1 + rate, -guarantee)) / rate;
                const deferred = annuity * Math.pow(1+rate, -guarantee); 
                annuity = (annuityCertain * 0.98) + deferred; // 0.98 factor seguridad
            }

            // Carga Comercial & Admin
            const netCapital = capital * 0.96; // 4% Comision
            
            const yearlyPension = netCapital / annuity;
            const monthlyPension = yearlyPension / 12;

            // Render
            document.getElementById('resPensionUF').innerText = formatUF(monthlyPension);
            document.getElementById('resPensionCLP').innerText = formatMoney(monthlyPension * currentUF) + " líquidos aprox.";

            // Payback
            const paybackYears = capital / yearlyPension;
            document.getElementById('resPayback').innerText = paybackYears.toFixed(1);
            document.getElementById('resPaybackMonths').innerText = Math.round(paybackYears * 12);

            // Tax (Interés Implícito apx 30% de la cuota en promedio)
            // Esto es muy simplificado, el interés decrece en el tiempo.
            const interestComponent = (monthlyPension * currentUF) * 0.30;
            // Si es renta privada, tributa global complementario sobre el interés.
            // Asumimos tasa marginal base (ej: tramo exento o bajo si es jubilado).
            // Mostramos 0 si es bajo, o un estimado si es alto.
            const estimatedTax = interestComponent > 800000 ? interestComponent * 0.04 : 0; 
            document.getElementById('resTax').innerText = formatMoney(estimatedTax);

            updateChart(capital, yearlyPension, age);
        }

        function updateChart(capital, yearlyPension, startAge) {
            const ctx = document.getElementById('breakevenChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();

            const labels = [];
            const dataAccumulated = [];
            const dataCapital = [];

            for(let i=0; i<=25; i++) {
                labels.push(`${startAge + i} años`);
                dataAccumulated.push(yearlyPension * i);
                dataCapital.push(capital);
            }

            Chart.defaults.font.family = "'Space Mono', monospace";
            Chart.defaults.color = '#94a3b8';

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Pensiones Acumuladas (UF)',
                            data: dataAccumulated,
                            borderColor: '#CCFF00',
                            backgroundColor: 'rgba(204, 255, 0, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Inversión Inicial',
                            data: dataCapital,
                            borderColor: '#ffffff',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#E6F4F1' } }
                    },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Start
        fetchUF();
    </script>
</body>
</html>
